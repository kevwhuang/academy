<!DOCTYPE html>

<head>
    <title>JavaScript: Web</title>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="author" content="Kevin Huang">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined">
    <link rel="stylesheet" href="../css/reset.css">

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/eslint/lib/api.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/express/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jest/build/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mysql/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/next/dist/server/next.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nodemon/lib/cli/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/postcss/lib/postcss.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/redux/dist/redux.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sass/sass.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/typescript/lib/typescript.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vite/dist/node/index.min.js"></script>

    <style>
        html {
            background: gray !important;
        }

        html div {
            background: black;
        }

        @media all and (prefers-reduced-motion),
        screen and (max-width: 750px) and (orientation: landscape),
        print and (color) and (20pc <=width <=40pc),
        only speech and (not (monochrome)) or (hover) {}
    </style>
</head>

<body>
    <a href="javascript:;" tabindex="-1">BOM</a><br><br>
    <a href="javascript:;" tabindex="-1">WINDOWS</a><br><br>
    <a href="javascript:;" tabindex="-1">DOM</a><br><br>
    <a href="javascript:;" tabindex="-1">DOM ELEMENTS</a><br><br>
    <a href="javascript:;" tabindex="-1">DOM LISTS</a><br><br>
    <a href="javascript:;" tabindex="-1">STYLE SHEETS</a><br><br>
    <a href="javascript:;" tabindex="0" accesskey="p">AJAX & FETCH</a><br><br>
    <a href="javascript:;" tabindex="0" contenteditable="true">EVENTS</a><br><br>

    <label for="input" role="WAI" aria-hidden="true" aria-readonly="true"></label>
    <input id="input" type="number" min="0" max="10" hidden>
    <input id="test" class="class-1 class-2" hidden>
    <div title="title" data-attribute="value">Parent
        <div style="display:none;">Child</div>
    </div>

    <!-- Comment Node -->
</body>

<script>
    const $ = document.querySelector.bind(document);
    const $$ = document.querySelectorAll.bind(document);
    const c = console.log;
    const cc = console.table;
    const hr = e => c(`%c***** ${e}`, 'color:seagreen;font-size:1pc;');
</script>

<script>
    'use strict';
    hr('BOM');

    c(this);
    c(console);
    c(history);
    c(localStorage);
    c(sessionStorage);

    cc({
        'location.hash': location.hash,
        'location.host': location.host,
        'location.hostname': location.hostname,
        'location.href': location.href,
        'location.origin': location.origin,
        'location.pathname': location.pathname,
        'location.port': location.port,
        'location.protocol': location.protocol,
        'location.search': location.search,
        'navigator.appVersion': navigator.appVersion,
        'navigator.cookieEnabled': navigator.cookieEnabled,
        'navigator.javaEnabled()': navigator.javaEnabled(),
        'navigator.language': navigator.language,
        'navigator.onLine': navigator.onLine,
        'navigator.platform': navigator.platform,
        'navigator.userAgentData.mobile': navigator.userAgentData.mobile,
        'screen.availHeight': screen.availHeight,
        'screen.availWidth': screen.availWidth,
        'screen.colorDepth': screen.colorDepth,
        'screen.height': screen.height,
        'screen.pixelDepth': screen.pixelDepth,
        'screen.width': screen.width,
        innerHeight: innerHeight,
        innerWidth: innerWidth,
        outerHeight: outerHeight,
        outerWidth: outerWidth,
    }, ['value']);

    document.cookie = 'username=admin';
    document.cookie = 'username=;expires=01 Jan 2000 00:00:00';

    c(localStorage.length);
    c(localStorage.setItem('key', 'value'));
    c(localStorage.key(1));
    c(localStorage.getItem('key'));
    localStorage.removeItem('key');
    localStorage.clear();

    const input = $('input');
    input.setAttribute('value', -1);
    input.setCustomValidity('Invalid');
    c(input.validity);
    c(input.validationMessage);
    c(input.willValidate);
    c(input.checkValidity());

    c(matchMedia('screen').matches);
    matchMedia('(max-width:750px)').addEventListener('change', () => c('mq - 750px'));

    c(crypto.getRandomValues(new BigInt64Array(5)));
    c(atob(btoa('Code')));
</script>

<script>
    'use strict';
    hr('WINDOWS');

    const popup = async () => {
        await new Promise(res => {
            setTimeout(() => {
                win = window.open('about:blank', '_blank', 'resizable');
                win.name = 'Popup';
                onbeforeunload = () => win.close();
                res();

                win.resizeTo(200, 200);
                win.resizeBy(56, 56);
                win.moveTo(200, 200);
                win.moveBy(-200, -200);
                win.scrollTo(100, 100);
                win.scrollBy(-100, -100);
                win.blur();
                win.focus();

                win.location = 'https://www.google.com';
                win.location.href = 'https://www.google.com';
                win.location.assign('https://www.google.com');
                win.location.replace('https://www.google.com');
                win.location.reload();

                win.history.back();
                win.history.forward();
                win.history.go(1);
            }, 0);
        });
        await new Promise(res => { setTimeout(() => { win.stop(); win.close(); res(); }, 5000); });
    };

    // eval(`popup()`); var win;
    // confirm('Text');
    // prompt('Text', 'Input');
    // print();
</script>

<script>
    'use strict';
    hr('DOM');

    c(document.URL, document.referrer);
    c(document.baseURI, document.documentURI);
    c(document.doctype, document.characterSet);
    c(document.lastModified, document.readyState);
    c(document.defaultView);
    c(document.activeElement);
    c(document.links, document.images, document.forms, document.scripts);
    c(document.hasFocus());

    document.createComment('comment');
    document.createEvent('MouseEvent');

    const iframe = document.createElement('iframe');
    iframe.src = 'template.html';
    iframe.style = 'display:none;';
    document.body.append(iframe);

    setTimeout(() => {
        const header = iframe.contentWindow.document.body.firstElementChild;
        document.importNode(header, true);
        document.adoptNode(header);
        document.body.lastChild.remove();
    }, 1000);
</script>

<script>
    'use strict';
    hr('DOM ELEMENTS');

    const ele1 = document.getElementsByName('author')[0].closest('html');
    const ele2 = document.getElementsByName('robots')[0];
    const ele3 = document.getElementsByTagName('div')[0];

    ele1.dir = 'auto';
    ele1.scrollTop = 0;
    ele1.scrollLeft = -100;
    ele1.normalize();
    c(ele1.namespaceURI);
    c(ele1.offsetHeight, ele1.clientWidth, ele1.scrollHeight);
    c(ele1.childElementCount);
    c(ele1.isDefaultNamespace('http://www.w3.org/1999/xhtml'));
    c(ele1.hasChildNodes());
    c(ele1.hasAttributes());
    c(ele1.getBoundingClientRect());

    ele2.lang = 'en';
    ele2.scrollIntoView(false);
    c(ele2.previousElementSibling);
    c(ele2.nextElementSibling);
    c(ele2.parentElement.parentNode.parentNode);
    c(ele2.ownerDocument.nodeType);
    c(ele2.offsetParent);
    c(ele2.offsetTop, ele2.offsetLeft);
    c(ele2.hasAttribute('name'));
    c(ele2.matches('meta,meta[lang]'));
    c(ele2.compareDocumentPosition(ele1));

    c(ele3.tagName);
    c(ele3.title);
    c(ele3.outerHTML);
    c(ele3.outerText);
    c(ele3.innerHTML);
    c(ele3.innerText);
    c(ele3.textContent);
    c(ele3.childNodes[0].nodeValue);
    c(ele3.firstElementChild.isSameNode(ele3.lastElementChild));
    c(ele3.firstElementChild.isEqualNode(ele3.lastElementChild));
    c(ele3.setAttributeNode(document.createAttribute('hidden')));
    c(ele3.removeAttributeNode(ele3.getAttributeNode('data-attribute')));
    c(ele3.replaceChild(document.createElement('div'), ele3.children[0]));
    c(ele3.removeChild(ele3.firstChild));
    c(ele3.removeChild(ele3.lastChild));

    c($$('div[style],div[title]')[0].previousSibling.nextSibling.tabIndex);
    c($$('a[tabindex="0"]')[1].isContentEditable);

    const newNode = document.createElement('main');
    document.head.insertBefore(newNode, document.head.children[0]);
    newNode.insertAdjacentText('afterbegin', 'text');
    newNode.insertAdjacentElement('beforeend', document.createElement('article'));
    newNode.insertAdjacentHTML('afterend', '<section></section>');
    newNode.nextElementSibling.remove();
    newNode.remove();
</script>

<script>
    'use strict';
    hr('DOM LISTS');

    const liveNL = document.documentElement.childNodes;
    const staticNL = $$('a');
    for (const k of liveNL.keys()) c('key:', k);
    for (const v of liveNL.values()) c('value:', v);
    for (const e of liveNL.entries()) c('entry:', e);
    liveNL.forEach((v, i, a) => c('tag:', liveNL.item(i).nodeName), this);

    const liveCL = document.getElementsByTagName('input');
    const dtl = liveCL.namedItem('test').classList;
    dtl.add('class-3', 'class-4');
    dtl.replace('class-4', 'class-5');
    dtl.toggle('class-5');
    dtl.remove('class-3');

    for (const k of dtl.keys()) c('key:', k);
    for (const v of dtl.values()) c('value:', v);
    for (const e of dtl.entries()) c('entry:', e);
    dtl.forEach((v, i, a) => c('contains:', dtl.contains(v)), this);

    const nnm = $('label').attributes;
    const node = document.createAttribute('attribute');
    node.value = 'value';
    nnm.setNamedItem(node);
    nnm.removeNamedItem('attribute');
    c(nnm.getNamedItem(nnm[nnm.length - 1].name).value);
</script>

<script>
    'use strict';
    hr('STYLE SHEETS');

    const div = document.createElement('div');
    const frag = document.createDocumentFragment();
    div.appendChild(document.createTextNode('text').cloneNode(true));
    frag.append(div);
    document.body.append(frag);
    div.setAttribute('style', 'width:100%;height:20vh;background:peru;');
    div.setAttribute('title', '');
    div.removeAttribute('title');
    div.remove();
    c(div);
    c(div.getAttributeNames());
    c(div.getAttribute('style'));
    c(div.style.cssText);

    const style = document.styleSheets[document.styleSheets.length - 1];
    c(style);
    c(style.rules[0].style.getPropertyPriority('background-color'));
    c(style.rules[0].style.getPropertyValue('background'));
    c(getComputedStyle(document.documentElement).getPropertyValue('background'));
    style.disabled = false;
    style.cssRules[0].style.setProperty('background', 'beige', 'important');
    style.cssRules[0].style.removeProperty('background');

    for (let i = 0; i < div.style.length; i++) c(`property: ${div.style[i]}`);
    for (let i = 0; i < style.cssRules.length; i++) c(style.cssRules[i].style.parentRule.cssText);
</script>

<script>
    'use strict';
    hr('AJAX & FETCH');

    (function () {
        const xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function () { c('State:', xhr.readyState); };
        xhr.onprogress = function () { c(this.status); };
        xhr.onload = function () { c(this.response); };
        xhr.onerror = function () { c('Error'); };

        xhr.abort();
        xhr.open('GET', '../documents/lorem.txt', true);
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.send();
    })();

    (function () {
        const xhr = new XMLHttpRequest();
        xhr.onload = function () { c(this.responseXML); };
        xhr.open('GET', '../documents/ajax.xml');
        xhr.send();
    })();

    (function () {
        const xhr = new XMLHttpRequest();
        xhr.onload = function () { if (this.status == 200) c(JSON.parse(this.responseText)); };
        xhr.open('GET', 'https://api.github.com/users');
        xhr.send();
    })();

    (function () {
        return fetch('../CNAME')
            .then(res => { if (!res.ok) throw Error(res.statusText); return res; })
            .then(res => res.text())
            .then(data => c(data));
    })();

    (function (source = {}) {
        const options = {
            method: 'POST',
            mode: 'cors',
            cache: 'default',
            credentials: 'same-origin',
            headers: new Headers({
                'Content-Type': 'application/json',
                redirect: 'follow',
                referrerPolicy: 'no-referrer',
            }),
            body: JSON.stringify(source),
        };

        options.headers.append('header', '');
        options.headers.delete('header');
        options.headers.has('header');

        return fetch(new Request('http://jsonplaceholder.typicode.com/posts', options))
            .then(res => res.json())
            .then(data => c(data))
            .then(() => hr('EVENTS'))
            .catch(err => c(err));
    })({ key: 'value' });
</script>

<script>
    'use strict';

    window.addEventListener('click', e => {
        document.designMode = "off";
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();

        if (!document.body.style.background) document.body.style.background = 'peru';
        else document.body.style.background = '';
        c(Math.floor(e.timeStamp / 1000) + 's', e.defaultPrevented, e.bubbles, e.cancelable);
    });

    const contextMenu = e => e.preventDefault();
    removeEventListener('contextmenu', contextMenu);
    addEventListener('contextmenu', contextMenu);
    addEventListener('click', function (e) { document.body.style.background = '#000'; e.click(); });

    onkeydown = function (e) { document.title = `${e.key} @ ${e.location}`; };
    onmousemove = e => document.title =
        `${e.screenX} ${e.clientX} ${e.pageX} ${e.offsetX} ` +
        `${top.pageXOffset} ${parent.scrollY} @ ${e.button}`;

    onresize = () => document.title = 'resizing';
    onscroll = () => document.title = 'scrolling';

    onload = () => document.title = 'load cached';
    onpageshow = () => document.title = 'page uncached';

    addEventListener('onbeforeunload', e => {
        e.preventDefault();
        document.title = 'before unload cached';
    });
    onunload = () => document.title = 'unload cached';
    onpagehide = () => document.title = 'page uncached';

    ononline = () => document.title = 'online';
    onoffline = () => document.title = 'offline';

    window.ontouchstart = () => document.title = 'touch start';
    window.ontouchmove = () => document.title = 'touch move';
    window.ontouchend = () => document.title = 'touch end';
    window.ontouchcancel = () => document.title = 'touch error';
</script>